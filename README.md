# python-namumark-parser
php-namumark는 나무위키에서 사용되는 나무마크를 python 언어를 이용해서 HTML과 미디어위키 문법에 맞게 변환하는 도구입니다.

본 라이브러리는 koreapyj님의 [PHP-namumark](https://github.com/koreapyj/php-namumark) 를 참조해서 만들었습니다. 

## 라이선스
본 라이브러리는 원본 소스에 따라 GNU Affero GPL 3.0에 따라 자유롭게 사용하실 수 있습니다. 

## 사용 방법
python 파일을 이용해서 텍스트 파일 하나를 미디어위키 문법으로 치환하는 기능을 제공하고 있습니다. 아직 완성되지 않은 점에 유의바랍니다.

1. 파이선을 설치합니다. 최소 3.6 버전 이상이 설치되어 있어야 하고, 3.8버전 이상을 권장합니다. 명령 프롬프트 창을 통해서 실행할 수 있는 준비가 되어있어야 합니다.
1. 다음 이 파서를 다운로드받습니다. 
1. main.py가 있는 디렉토리에 나무마크로 작성된 텍스트 파일 하나를 작성합니다. (예시: test.txt)
1. 커맨드 창으로 main.py가 있는 디렉토리에 들어가서 다음과 같이 코드를 실행시키면 문법 변환이 작동합니다.
1. 파일명에서는 확장자는 생략해서 입력하고, 변환결과 파일명을 생략하면 변환 결과가 mw.txt로 저장됩니다.
```
   python main.py (변환대상 파일명) (변환결과 파일명)
```

## 현재 사용가능
완성된 기능은 없다는 점에서 유의하시기 바랍니다. 현재 체크된 부분은 부분적으로나마 구현된 부분입니다.

* 취소선 등의 글자 효과
* 목차, include, math 등의 매크로
* 여러 줄 표현
* 리스트 형태 문법
* 표 문법 (아직 미완성되었음)
* `>` 태그를 이용한 블록 문법. 리브레 위키에 최적화되어 있음. 


## 요구되는 확장기능

미디어위키 변환도구에서 온전하게 사용하려면 다음과 같은 확장기능을 설치하셔야 제대로 작동합니다.
* Cite (각주 처리)
* Math 또는 SimpleMathJax (수식 처리)
* ParserFunction (일부 매크로는 파서함수를 사용하므로)
* SyntaxHighlight (문법 강조)
* YouTube (youtube, nicovideo 사용) 
* [{{색}} 틀 - 리브레 위키 참조](https://librewiki.net/wiki/틀:색) - 
  보기 좋게 정리하기 위해 사용합니다.
* [{{각주}} 틀 - 리브레 위키 참조](https://librewiki.net/wiki/틀:각주) - 
  보기 좋게 정리하기 위해 사용합니다.
* [{{숨김 시작}}, {{숨김 끝}} 틀 - 리브레 위키 참조](https://librewiki.net/wiki/틀:숨김_시작) - 
  folding 문법 처리를 위해 사용합니다.

## 미지원 기능
미디어위키 엔진의 한계와 파서로 처리하기 난감한 부분이 있어서 다음과 같은 기능은 당분간 지원하지 않을 예정입니다.
* 다른 문서의 문단명 넘겨주기 `[[문서명#s-문단번호]]`. 미디어위키는 문단번호 대신 문단의 이름을 사용하지만 
  다른 문서의 문단 정보를 알 길이 없기에 값을 찾을 수 없습니다.
* 이중 각주 기능. 미디어위키 Cite 확장기능의 구조적 한계로 인해 `<ref>` 태그 안에 `<ref>`를 집어넣을 수 없습니다.
* 다크 모드용 색 지정 태그 `{{{#color1,#color2 contents}}}`
* <colcolor>, <colbgcolor> 등 표에서 열과 관련된 기능들. 
* youtube, nicovideo 매크로 이외 vimeo, navertv, kakaotv 동영상 지원 매크로
* 나무마크에서 미지원되고 미디어위키에서 지원되는 `<b>`태그나 `&larrow;`같은 엠퍼서드 입력 기능, `{| ... |}`와 같은 표 입력 기능은 
강제 문자 치환 등을 통해 비활성화시키지 않습니다. 따라서 나무위키에서 지원 안 하는 태그가 변환 파서에서는 지원되어 결과값이 바뀌는 점에 유의해주세요.
* 파서 처리 방식이 변경되어서 중괄호 3개 단위로 관리하는 방식으로 처리욉니다. 따라서 `{{{#!syntax }}}`(문법 강조 기호) 혹은 `{{{}}}`(문법 무시 기호) 
안에서 중괄호 3개(`{{{`)를 닫지 않고 사용하는 경우 오류가 날 수 있습니다.
  
## 랜더링 오류기 있는 부분
* 블록(`>`)이나 리스트 문법(`*` 등)의 경우 변환기는 개행기호(`\n`)를 기준으로 범위를 지정합니다. 
이 때문에 블록이나 리스트 영역을 html 등의 렌더링 기호(`{{{#!(기호) ... }}}`로 감쌀 때 마지막의 `}}}` 기호를 아래처럼 줄바꿈 없이 사용할 경우 랜더링 오류가 날 수 있습니다. 
반드시 아래와 같이 `}}}` 기호를 줄바꿈 아래부분에 공백 없이 작성해주시기 바랍니다.

```
{{{#!wiki style="background-color:grey;"  
  1. 리스트1
  1. 리스트2    
}}}
```

* 미디어위키와는 달리 `'''`(진하게), `''`(기울임) 태그 등은 여러 줄에 걸처서 변환이 되지 않습니다. 
